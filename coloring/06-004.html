<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Daily Tasks</title>
    
    <!-- Fonts: Playfair Display (Serif for headers) and Lato (Sans for UI) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <style>
        :root {
            /* 配色パレット: 古い新聞紙とインク */
            --bg-paper: #F4F1EA;
            --bg-paper-dark: #E8E4D9;
            --ink-primary: #2C2C2C;
            --ink-secondary: #595959;
            --ink-faint: #A0A0A0;
            --accent-red: #8B0000; /* エラーや強調用 */
            --border-color: #2C2C2C;
            
            --font-serif: 'Playfair Display', serif;
            --font-sans: 'Lato', sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-paper);
            color: var(--ink-primary);
            font-family: var(--font-sans);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding: 20px;
        }

        /* コンテナデザイン: 新聞のコラム風 */
        .container {
            width: 100%;
            max-width: 600px;
            background-color: var(--bg-paper);
            /* 紙の質感を出すための微細なノイズ画像があれば尚良いが、今回は色で表現 */
            position: relative;
        }

        /* ヘッダーセクション */
        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px double var(--border-color);
            padding-bottom: 15px;
        }

        h1 {
            font-family: var(--font-serif);
            font-size: 3rem;
            font-weight: 700;
            letter-spacing: -1px;
            text-transform: uppercase;
            margin-bottom: 5px;
            line-height: 1.1;
        }

        .date-line {
            font-family: var(--font-serif);
            font-style: italic;
            color: var(--ink-secondary);
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
            padding: 4px 0;
            margin-top: 10px;
        }

        /* 入力エリア */
        .input-group {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 20px;
        }

        input[type="text"] {
            flex: 1;
            background: transparent;
            border: 1px solid var(--ink-secondary);
            padding: 12px;
            font-family: var(--font-sans);
            font-size: 1rem;
            color: var(--ink-primary);
            outline: none;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            border-color: var(--ink-primary);
            background-color: #fffbf0;
        }

        button.add-btn {
            background-color: var(--ink-primary);
            color: var(--bg-paper);
            border: none;
            padding: 0 20px;
            font-family: var(--font-sans);
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            letter-spacing: 1px;
            transition: background-color 0.3s;
        }

        button.add-btn:hover {
            background-color: #000;
        }

        /* フィルターとステータスバー */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-family: var(--font-sans);
            font-size: 0.9rem;
        }

        .filter-group label {
            margin-right: 15px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
        }

        .filter-group input[type="radio"] {
            margin-right: 5px;
            accent-color: var(--ink-primary);
        }

        /* エラーメッセージ表示エリア */
        #error-container {
            background-color: transparent;
            color: var(--accent-red);
            font-family: var(--font-serif);
            font-style: italic;
            padding: 0;
            margin-bottom: 15px;
            min-height: 0;
            opacity: 0;
            transition: opacity 0.3s;
            text-align: center;
            border: 1px dashed var(--accent-red);
            display: none; /* 初期状態は非表示 */
        }
        
        #error-container.visible {
            display: block;
            opacity: 1;
            padding: 10px;
        }

        /* ToDoリスト */
        .todo-list {
            list-style: none;
        }

        .todo-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #d4d1c9;
            transition: background-color 0.2s;
        }

        .todo-item:last-child {
            border-bottom: none;
        }

        .todo-item:hover {
            background-color: rgba(0,0,0,0.02);
        }

        /* チェックボックスのカスタムスタイル */
        .checkbox-wrapper {
            position: relative;
            margin-right: 15px;
            width: 20px;
            height: 20px;
        }

        .todo-checkbox {
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
            position: absolute;
            z-index: 2;
        }

        .custom-checkbox {
            position: absolute;
            top: 0;
            left: 0;
            width: 20px;
            height: 20px;
            border: 2px solid var(--ink-primary);
            z-index: 1;
        }

        .todo-checkbox:checked + .custom-checkbox::after {
            content: '';
            position: absolute;
            left: 5px;
            top: 1px;
            width: 6px;
            height: 12px;
            border: solid var(--ink-primary);
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        /* テキストエリア */
        .todo-text {
            flex: 1;
            font-size: 1.1rem;
            color: var(--ink-primary);
            cursor: text;
            margin-right: 10px;
            position: relative;
        }
        
        /* 編集モードのインプット */
        .edit-input {
            flex: 1;
            font-size: 1.1rem;
            font-family: var(--font-sans);
            color: var(--ink-primary);
            border: none;
            border-bottom: 1px solid var(--ink-primary);
            background: transparent;
            outline: none;
            padding: 0;
            margin-right: 10px;
        }

        /* 完了済みスタイル */
        .todo-item.completed .todo-text {
            text-decoration: line-through;
            color: var(--ink-faint);
            font-style: italic;
        }

        .todo-item.completed .edit-input {
            color: var(--ink-faint);
            text-decoration: line-through;
        }

        /* 削除ボタン */
        .delete-btn {
            background: transparent;
            border: none;
            color: var(--ink-primary);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px;
            opacity: 0.6;
            transition: opacity 0.3s, color 0.3s;
            font-family: var(--font-serif);
        }

        .delete-btn:hover {
            opacity: 1;
            color: var(--accent-red);
        }

        /* レスポンシブ調整 */
        @media (max-width: 480px) {
            h1 { font-size: 2.2rem; }
            .date-line { font-size: 0.8rem; flex-direction: column; align-items: center; gap: 5px;}
            .input-group { flex-direction: column; gap: 10px; }
            input[type="text"] { width: 100%; }
            button.add-btn { width: 100%; padding: 12px; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>The Daily Tasks</h1>
        <div class="date-line">
            <span id="current-date">Vol. 1, No. 1</span>
            <span>Edition: Standard</span>
            <span>Price: Free</span>
        </div>
    </header>

    <div id="error-container"></div>

    <div class="input-group">
        <input type="text" id="new-todo" placeholder="What needs to be done today?" autocomplete="off">
        <button class="add-btn" id="add-btn">Publish</button>
    </div>

    <div class="controls">
        <span id="items-left">0 items left</span>
        <div class="filter-group">
            <label>
                <input type="radio" name="filter" value="all" checked> All
            </label>
            <label>
                <input type="radio" name="filter" value="active"> Unfinished
            </label>
        </div>
    </div>

    <ul class="todo-list" id="todo-list">
        <!-- JSでリスト項目をここに描画 -->
    </ul>
</div>

<script>
    /**
     * アプリケーションの状態管理
     */
    const STORAGE_KEY = 'daily_tasks_data_v1';
    
    // 初期ダミーデータ
    const DUMMY_DATA = [
        { id: '1', text: '朝のコーヒーを淹れる', completed: true, createdAt: Date.now() },
        { id: '2', text: 'プロジェクトの進捗報告を作成する', completed: false, createdAt: Date.now() },
        { id: '3', text: '海外ニュース記事を読む', completed: false, createdAt: Date.now() },
        { id: '4', text: 'ジムへ行く準備', completed: false, createdAt: Date.now() },
        { id: '5', text: '夕食の食材リストを作成', completed: false, createdAt: Date.now() }
    ];

    let todos = [];
    let filter = 'all'; // 'all' or 'active'

    // DOM要素
    const todoListEl = document.getElementById('todo-list');
    const newTodoInput = document.getElementById('new-todo');
    const addBtn = document.getElementById('add-btn');
    const itemsLeftEl = document.getElementById('items-left');
    const filterRadios = document.querySelectorAll('input[name="filter"]');
    const errorContainer = document.getElementById('error-container');
    const dateEl = document.getElementById('current-date');

    /**
     * 初期化処理
     */
    function init() {
        // 今日の日付を表示
        const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
        dateEl.textContent = new Date().toLocaleDateString('en-US', options);

        loadTodos();
        render();
        setupEventListeners();
    }

    /**
     * データ読み込み (エラーハンドリング付き)
     */
    function loadTodos() {
        try {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                todos = JSON.parse(stored);
            } else {
                // 初回起動時はダミーデータをセット
                todos = [...DUMMY_DATA];
                saveTodos();
            }
        } catch (e) {
            showError("Failed to retrieve data from local storage. Please check your browser settings.");
            console.error("Load Error:", e);
            todos = [];
        }
    }

    /**
     * データ保存 (エラーハンドリング付き)
     */
    function saveTodos() {
        try {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(todos));
            hideError();
        } catch (e) {
            showError("Failed to save changes. Storage might be full.");
            console.error("Save Error:", e);
        }
    }

    /**
     * エラー表示
     */
    function showError(message) {
        errorContainer.textContent = `Error: ${message}`;
        errorContainer.classList.add('visible');
    }

    function hideError() {
        errorContainer.classList.remove('visible');
    }

    /**
     * ToDoの追加
     */
    function addTodo() {
        const text = newTodoInput.value.trim();
        if (text === '') return;

        const newTodo = {
            id: Date.now().toString(),
            text: text,
            completed: false,
            createdAt: Date.now()
        };

        todos.unshift(newTodo); // 新しいものを上に
        saveTodos();
        render();
        newTodoInput.value = '';
    }

    /**
     * ToDoの削除
     */
    function deleteTodo(id) {
        if(!confirm("Are you sure you want to delete this item?")) return;
        todos = todos.filter(t => t.id !== id);
        saveTodos();
        render();
    }

    /**
     * 完了状態の切り替え
     */
    function toggleComplete(id) {
        todos = todos.map(t => {
            if (t.id === id) {
                return { ...t, completed: !t.completed };
            }
            return t;
        });
        saveTodos();
        render();
    }

    /**
     * 編集モード開始
     */
    function startEdit(id, spanElement) {
        const todo = todos.find(t => t.id === id);
        if (!todo) return;

        // spanをinputに置換
        const input = document.createElement('input');
        input.type = 'text';
        input.value = todo.text;
        input.className = 'edit-input';
        
        // フォーカスが外れたら保存
        input.onblur = () => finishEdit(id, input.value);
        
        // Enterキーで保存
        input.onkeydown = (e) => {
            if (e.key === 'Enter') {
                input.blur();
            }
        };

        spanElement.replaceWith(input);
        input.focus();
    }

    /**
     * 編集終了（保存）
     */
    function finishEdit(id, newText) {
        const text = newText.trim();
        if (text === '') {
            // 空の場合は削除扱いにするか、元の値に戻すか。今回は元の値に戻さない場合は削除せず、変更なしとする
             render(); // 再描画してinputをspanに戻す
             return;
        }

        todos = todos.map(t => {
            if (t.id === id) {
                return { ...t, text: text };
            }
            return t;
        });

        saveTodos();
        render();
    }

    /**
     * 描画ロジック
     */
    function render() {
        todoListEl.innerHTML = '';

        // フィルタリング
        const filteredTodos = todos.filter(todo => {
            if (filter === 'active') return !todo.completed;
            return true;
        });

        // リスト生成
        filteredTodos.forEach(todo => {
            const li = document.createElement('li');
            li.className = `todo-item ${todo.completed ? 'completed' : ''}`;
            
            // チェックボックス
            const checkboxWrapper = document.createElement('div');
            checkboxWrapper.className = 'checkbox-wrapper';
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'todo-checkbox';
            checkbox.checked = todo.completed;
            checkbox.onchange = () => toggleComplete(todo.id);

            const customCheck = document.createElement('div');
            customCheck.className = 'custom-checkbox';

            checkboxWrapper.appendChild(checkbox);
            checkboxWrapper.appendChild(customCheck);

            // テキスト
            const span = document.createElement('span');
            span.className = 'todo-text';
            span.textContent = todo.text;
            span.onclick = () => {
                // 完了済みでも編集できるようにするか？ -> 要件「クリックしたら編集モード」に従う
                startEdit(todo.id, span);
            };

            // 削除ボタン
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-btn';
            deleteBtn.innerHTML = '&times;'; // ×記号
            deleteBtn.title = 'Delete';
            deleteBtn.onclick = () => deleteTodo(todo.id);

            li.appendChild(checkboxWrapper);
            li.appendChild(span);
            li.appendChild(deleteBtn);
            
            todoListEl.appendChild(li);
        });

        // カウント更新
        const activeCount = todos.filter(t => !t.completed).length;
        itemsLeftEl.textContent = `${activeCount} item${activeCount !== 1 ? 's' : ''} left`;
    }

    /**
     * イベントリスナーの設定
     */
    function setupEventListeners() {
        // 追加ボタン
        addBtn.addEventListener('click', addTodo);
        
        // Enterキーで追加
        newTodoInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addTodo();
        });

        // フィルター変更
        filterRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                filter = e.target.value;
                render();
            });
        });
    }

    // アプリ起動
    init();

</script>
</body>
</html>