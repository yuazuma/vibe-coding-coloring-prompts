<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROJECT: TODO</title>
    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome (Icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        concrete: {
                            50: '#fcfcfc',
                            100: '#f5f5f5',
                            200: '#e5e5e5',
                            300: '#d4d4d4',
                            400: '#a3a3a3',
                            500: '#737373',
                            600: '#525252',
                            700: '#404040',
                            800: '#262626',
                            900: '#171717',
                        }
                    },
                    fontFamily: {
                        mono: ['"Courier New"', 'Courier', 'monospace'], // Typewriter/Blueprint feel
                        sans: ['"Helvetica Neue"', 'Arial', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #e5e5e5;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%239C92AC' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
        }
        
        /* Custom scrollbar for webkit */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #d4d4d4; 
        }
        ::-webkit-scrollbar-thumb {
            background: #737373; 
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #525252; 
        }

        /* Architectural Checkbox */
        .arch-checkbox {
            appearance: none;
            background-color: transparent;
            margin: 0;
            font: inherit;
            color: currentColor;
            width: 1.2em;
            height: 1.2em;
            border: 2px solid #525252;
            display: grid;
            place-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .arch-checkbox::before {
            content: "";
            width: 0.65em;
            height: 0.65em;
            transform: scale(0);
            transition: 120ms transform ease-in-out;
            box-shadow: inset 1em 1em #262626;
            background-color: #262626;
        }

        .arch-checkbox:checked::before {
            transform: scale(1);
        }

        /* Input underline animation */
        .input-underline {
            position: relative;
        }
        .input-underline::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0%;
            height: 2px;
            background-color: #262626;
            transition: width 0.3s ease;
        }
        .input-underline:focus-within::after {
            width: 100%;
        }

        /* Smooth fade in */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
    </style>
</head>
<body class="text-concrete-800 font-mono min-h-screen flex items-center justify-center p-4">

    <!-- Main Container -->
    <div class="w-full max-w-2xl bg-concrete-100 shadow-2xl border-t-8 border-concrete-800 flex flex-col relative overflow-hidden">
        
        <!-- Header Section -->
        <header class="p-6 md:p-8 bg-concrete-200 border-b border-concrete-300">
            <div class="flex justify-between items-end mb-4">
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold tracking-tighter text-concrete-900 uppercase">Project: ToDo</h1>
                    <p class="text-xs text-concrete-500 mt-1 tracking-widest">ARCHITECTURAL TASK MANAGER v1.0</p>
                </div>
                <div class="text-right hidden md:block">
                    <p class="text-xs font-bold" id="date-display">2023.10.27</p>
                    <p class="text-xs text-concrete-500">STATUS: ACTIVE</p>
                </div>
            </div>

            <!-- Input Area -->
            <div class="mt-6 flex gap-2 input-underline">
                <input 
                    type="text" 
                    id="new-todo-input" 
                    placeholder="新しいタスクを入力..." 
                    class="flex-1 bg-transparent border-b-2 border-concrete-400 py-2 px-2 focus:outline-none placeholder-concrete-400 text-lg"
                    onkeypress="handleKeyPress(event)"
                >
                <button 
                    onclick="addTodo()" 
                    class="bg-concrete-800 text-concrete-50 hover:bg-concrete-700 px-6 py-2 text-sm font-bold uppercase tracking-wider transition-colors duration-200"
                >
                    ADD <i class="fa-solid fa-plus ml-1"></i>
                </button>
            </div>
        </header>

        <!-- Filter Controls -->
        <div class="px-6 py-3 bg-concrete-50 border-b border-concrete-200 flex justify-between items-center text-xs md:text-sm font-bold uppercase">
            <div class="flex gap-4">
                <button onclick="setFilter('all')" id="filter-all" class="text-concrete-900 border-b-2 border-concrete-900 pb-0.5 transition-all">All Tasks</button>
                <button onclick="setFilter('active')" id="filter-active" class="text-concrete-400 hover:text-concrete-600 border-b-2 border-transparent hover:border-concrete-400 pb-0.5 transition-all">Incomplete</button>
            </div>
            <div class="text-concrete-400">
                <span id="task-count">0</span> TASKS
            </div>
        </div>

        <!-- Task List -->
        <div class="bg-concrete-100 min-h-[400px] max-h-[60vh] overflow-y-auto relative">
            <ul id="todo-list" class="divide-y divide-concrete-300">
                <!-- Tasks will be injected here -->
            </ul>
            
            <!-- Empty State -->
            <div id="empty-state" class="hidden absolute inset-0 flex flex-col items-center justify-center text-concrete-400 pointer-events-none">
                <i class="fa-solid fa-layer-group text-4xl mb-3 opacity-20"></i>
                <p class="text-sm tracking-widest opacity-40">NO TASKS FOUND</p>
            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-concrete-200 p-2 text-center text-[10px] text-concrete-400 border-t border-concrete-300 uppercase tracking-widest">
            System Ready &bull; GitHub Pages Deployment Compatible
        </footer>
    </div>

    <!-- Notification Toast (Error Handling UI) -->
    <div id="toast" class="fixed bottom-5 left-1/2 transform -translate-x-1/2 bg-concrete-800 text-white px-6 py-3 shadow-lg flex items-center gap-3 transition-all duration-300 opacity-0 translate-y-10 pointer-events-none z-50 max-w-[90vw]">
        <div id="toast-icon"><i class="fa-solid fa-circle-info"></i></div>
        <div class="flex flex-col">
            <span id="toast-title" class="text-xs font-bold uppercase tracking-wider text-concrete-300">Notification</span>
            <span id="toast-message" class="text-sm">Message goes here</span>
        </div>
    </div>

    <script>
        // --- State Management ---
        let todos = [];
        let filter = 'all'; // 'all' or 'active'

        // --- Mock Data ---
        const dummyData = [
            { id: '1', text: 'クライアント向けプレゼン資料作成', completed: false },
            { id: '2', text: 'コンクリート素材のサンプル発注', completed: true },
            { id: '3', text: 'A邸 現場視察 (14:00)', completed: false },
            { id: '4', text: '構造計算書の修正確認', completed: false },
            { id: '5', text: 'オフィス備品補充', completed: true },
        ];

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            updateDate();
            // Simulate fetching data
            simulateFetchData();
        });

        function updateDate() {
            const now = new Date();
            const dateString = now.toLocaleDateString('ja-JP', { year: 'numeric', month: '2-digit', day: '2-digit' }).replace(/\//g, '.');
            document.getElementById('date-display').textContent = dateString;
        }

        // --- Simulated API Calls (Mocking async operations) ---
        async function simulateFetchData() {
            try {
                // Simulate network delay
                await new Promise(resolve => setTimeout(resolve, 600)); 
                
                // Simulate success
                todos = [...dummyData];
                render();
                showToast('Success', 'データ同期完了', 'success');
            } catch (error) {
                showToast('Error', 'データの取得に失敗しました', 'error');
                // Fallback to empty
                todos = [];
                render();
            }
        }

        // --- Core Functions ---

        function addTodo() {
            const input = document.getElementById('new-todo-input');
            const text = input.value.trim();

            if (!text) {
                showToast('Warning', 'タスク内容を入力してください', 'warning');
                return;
            }

            const newTodo = {
                id: Date.now().toString(),
                text: text,
                completed: false
            };

            // Optimistic update
            todos.unshift(newTodo);
            input.value = '';
            render();
            showToast('Success', 'タスクを作成しました', 'success');
        }

        function deleteTodo(id) {
            if(confirm('このタスクを削除しますか？')) {
                todos = todos.filter(t => t.id !== id);
                render();
                showToast('Deleted', 'タスクを削除しました', 'default');
            }
        }

        function toggleTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (todo) {
                todo.completed = !todo.completed;
                render();
            }
        }

        // --- Edit Mode Logic (Inline) ---
        function enableEditMode(id) {
            const span = document.getElementById(`text-${id}`);
            const currentText = span.innerText;
            
            // Create input element
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentText;
            input.className = 'bg-concrete-200 border-b border-concrete-600 text-concrete-900 w-full focus:outline-none py-1';
            input.id = `edit-input-${id}`;
            
            // Replace span with input
            span.parentNode.replaceChild(input, span);
            input.focus();

            // Save on Enter or Blur
            const saveEdit = () => {
                const newText = input.value.trim();
                if (newText) {
                    // Update state
                    const todo = todos.find(t => t.id === id);
                    if(todo) todo.text = newText;
                    render(); // Re-render to show span again
                    showToast('Updated', 'タスクを更新しました', 'success');
                } else {
                    // Revert if empty
                    render();
                    showToast('Warning', '内容は空にできません', 'warning');
                }
            };

            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    saveEdit();
                } else if (e.key === 'Escape') {
                    render(); // Cancel
                }
            });
            
            input.addEventListener('blur', saveEdit);
        }


        // --- Filtering ---
        function setFilter(type) {
            filter = type;
            
            // Update UI styles for tabs
            const allBtn = document.getElementById('filter-all');
            const activeBtn = document.getElementById('filter-active');
            
            if (type === 'all') {
                allBtn.className = 'text-concrete-900 border-b-2 border-concrete-900 pb-0.5 transition-all';
                activeBtn.className = 'text-concrete-400 hover:text-concrete-600 border-b-2 border-transparent hover:border-concrete-400 pb-0.5 transition-all';
            } else {
                allBtn.className = 'text-concrete-400 hover:text-concrete-600 border-b-2 border-transparent hover:border-concrete-400 pb-0.5 transition-all';
                activeBtn.className = 'text-concrete-900 border-b-2 border-concrete-900 pb-0.5 transition-all';
            }
            
            render();
        }

        // --- Rendering ---
        function render() {
            const listElement = document.getElementById('todo-list');
            const countElement = document.getElementById('task-count');
            const emptyState = document.getElementById('empty-state');
            
            listElement.innerHTML = '';

            // Filter Logic
            const filteredTodos = todos.filter(todo => {
                if (filter === 'active') return !todo.completed;
                return true;
            });

            countElement.textContent = filteredTodos.length;

            if (filteredTodos.length === 0) {
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
            }

            filteredTodos.forEach(todo => {
                const li = document.createElement('li');
                li.className = 'p-4 flex items-center gap-4 hover:bg-concrete-200 transition-colors duration-150 group animate-fade-in';
                
                // Completed styling
                const textStyle = todo.completed ? 'text-concrete-400 line-through' : 'text-concrete-800';
                
                li.innerHTML = `
                    <input 
                        type="checkbox" 
                        class="arch-checkbox shrink-0" 
                        ${todo.completed ? 'checked' : ''} 
                        onchange="toggleTodo('${todo.id}')"
                    >
                    
                    <div class="flex-1 cursor-text" onclick="if(!document.getElementById('edit-input-${todo.id}')) enableEditMode('${todo.id}')">
                        <span id="text-${todo.id}" class="${textStyle} block break-all font-sans font-medium select-none">${escapeHtml(todo.text)}</span>
                    </div>

                    <button 
                        onclick="deleteTodo('${todo.id}')" 
                        class="text-concrete-400 hover:text-red-700 opacity-0 group-hover:opacity-100 transition-all duration-200 px-2"
                        title="Delete"
                    >
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                `;
                
                listElement.appendChild(li);
            });
        }

        // --- Utilities ---
        
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                addTodo();
            }
        }

        function escapeHtml(text) {
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Toast Notification Logic
        function showToast(title, message, type = 'default') {
            const toast = document.getElementById('toast');
            const toastTitle = document.getElementById('toast-title');
            const toastMsg = document.getElementById('toast-message');
            const toastIcon = document.getElementById('toast-icon');

            // Colors based on type
            let bgClass = 'bg-concrete-800';
            let iconHtml = '<i class="fa-solid fa-circle-info"></i>';

            if (type === 'error') {
                bgClass = 'bg-red-900'; // Dark red for errors
                iconHtml = '<i class="fa-solid fa-circle-exclamation"></i>';
            } else if (type === 'success') {
                iconHtml = '<i class="fa-solid fa-check"></i>';
            } else if (type === 'warning') {
                bgClass = 'bg-orange-900';
                iconHtml = '<i class="fa-solid fa-triangle-exclamation"></i>';
            }

            toast.className = `fixed bottom-5 left-1/2 transform -translate-x-1/2 text-white px-6 py-3 shadow-2xl flex items-center gap-4 transition-all duration-300 z-50 max-w-[90vw] border-l-4 border-white ${bgClass}`;
            
            toastTitle.textContent = title;
            toastMsg.textContent = message;
            toastIcon.innerHTML = iconHtml;

            // Show
            toast.classList.remove('opacity-0', 'translate-y-10', 'pointer-events-none');
            
            // Hide after 3 seconds
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-10', 'pointer-events-none');
            }, 3000);
        }
    </script>
</body>
</html>