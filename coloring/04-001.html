<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>シンプルなToDoアプリ</title>
    <!-- Tailwind CSS for styling structure -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts: Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        forest: {
                            950: '#0a150a', /* 最も暗い背景 */
                            900: '#112211', /* メイン背景 */
                            800: '#1a331a', /* コンテナ背景 */
                            700: '#2d4a2d', /* アイテム背景 */
                            600: '#3e663e', /* ホバーなど */
                            500: '#4f804f', /* アクセント */
                        },
                        wood: {
                            900: '#3e2723',
                            800: '#4e342e',
                            700: '#5d4037', /* ボタン基本色 */
                            600: '#6d4c41', /* ボタンホバー */
                            500: '#8d6e63',
                        },
                        leaf: {
                            100: '#dcedc8', /* テキスト薄 */
                            200: '#c5e1a5', /* テキスト濃 */
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #112211; /* fallback */
            color: #dcedc8;
        }
        /* スクロールバーのカスタマイズ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0a150a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #2d4a2d; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #3e663e; 
        }

        .todo-item {
            transition: all 0.3s ease;
        }
        .todo-item.completed .todo-text {
            text-decoration: line-through;
            opacity: 0.6;
            color: #8d6e63;
        }
        
        /* チェックボックスのカスタマイズ */
        .custom-checkbox {
            appearance: none;
            background-color: #1a331a;
            margin: 0;
            font: inherit;
            color: currentColor;
            width: 1.25em;
            height: 1.25em;
            border: 2px solid #5d4037;
            border-radius: 0.15em;
            display: grid;
            place-content: center;
            cursor: pointer;
            transition: 0.2s;
        }

        .custom-checkbox::before {
            content: "";
            width: 0.65em;
            height: 0.65em;
            transform: scale(0);
            transition: 120ms transform ease-in-out;
            box-shadow: inset 1em 1em #dcedc8; /* チェックマークの色 */
            transform-origin: center;
            clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
        }

        .custom-checkbox:checked::before {
            transform: scale(1);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-forest-900 min-h-screen font-sans text-leaf-100 flex flex-col items-center py-8 px-4">

    <!-- エラーメッセージ表示エリア（固定配置） -->
    <div id="error-container" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 w-full max-w-md px-4 pointer-events-none">
        <!-- JSでここにエラーメッセージを挿入 -->
    </div>

    <!-- メインコンテナ -->
    <div class="w-full max-w-2xl bg-forest-800 rounded-xl shadow-2xl overflow-hidden border border-forest-700">
        
        <!-- ヘッダー -->
        <header class="bg-forest-950 p-6 border-b border-forest-700 text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-wood-700 via-forest-500 to-wood-700"></div>
            <h1 class="text-3xl font-bold text-leaf-200 tracking-wider">
                <i class="fas fa-tree mr-2 text-forest-500"></i>Forest ToDo
            </h1>
            <p class="text-forest-500 text-sm mt-1">心静かにタスクを整理する</p>
        </header>

        <!-- コントロールエリア -->
        <div class="p-6 bg-forest-800">
            <!-- 入力フォーム -->
            <div class="flex flex-col sm:flex-row gap-3 mb-6">
                <input type="text" id="new-todo-input" 
                    class="flex-grow bg-forest-900 border border-forest-600 text-leaf-100 text-lg rounded-lg focus:ring-2 focus:ring-wood-600 focus:border-wood-600 block w-full p-3 placeholder-forest-500 transition-colors" 
                    placeholder="新しいタスクを入力..."
                    autocomplete="off">
                <button id="add-btn" 
                    class="bg-wood-700 hover:bg-wood-600 text-leaf-100 font-bold py-3 px-6 rounded-lg transition-colors shadow-lg flex items-center justify-center gap-2">
                    <i class="fas fa-plus"></i> 追加
                </button>
            </div>

            <!-- フィルターとステータス -->
            <div class="flex justify-between items-center pb-2 border-b border-forest-700">
                <div class="text-sm text-forest-500">
                    <span id="task-count">0</span> 件のタスク
                </div>
                <div class="flex items-center gap-2">
                    <label for="filter-checkbox" class="flex items-center gap-2 cursor-pointer select-none text-sm text-leaf-200 hover:text-white transition-colors">
                        <input type="checkbox" id="filter-checkbox" class="w-4 h-4 text-wood-600 bg-forest-900 border-forest-600 rounded focus:ring-wood-600 focus:ring-2">
                        未完了のみ表示
                    </label>
                </div>
            </div>
        </div>

        <!-- ToDoリスト表示エリア -->
        <ul id="todo-list" class="divide-y divide-forest-700 max-h-[60vh] overflow-y-auto">
            <!-- JSでアイテムを追加 -->
        </ul>
        
        <!-- フッター -->
        <div class="p-4 bg-forest-950 text-center text-xs text-forest-600">
            &copy; Forest ToDo App
        </div>
    </div>

    <script>
        // --- 状態管理 ---
        let todos = [];
        let isFilterActive = false;

        // --- ダミーデータ ---
        const dummyData = [
            { id: 1, text: "朝の散歩に行く", completed: true },
            { id: 2, text: "プロジェクトの企画書を作成する", completed: false },
            { id: 3, text: "観葉植物に水をやる", completed: false },
            { id: 4, text: "読書（15ページ読む）", completed: false },
            { id: 5, text: "週末のキャンプの準備", completed: false },
        ];

        // --- DOM要素 ---
        const todoListEl = document.getElementById('todo-list');
        const inputEl = document.getElementById('new-todo-input');
        const addBtn = document.getElementById('add-btn');
        const filterCheckbox = document.getElementById('filter-checkbox');
        const taskCountEl = document.getElementById('task-count');
        const errorContainer = document.getElementById('error-container');

        // --- 初期化 ---
        function init() {
            // ダミーデータをロード
            // 実運用ではlocalStorageから読み込むなどが想定される
            try {
                todos = [...dummyData];
                render();
            } catch (e) {
                showError('データの読み込みに失敗しました。');
            }

            // イベントリスナー設定
            addBtn.addEventListener('click', addTodo);
            inputEl.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addTodo();
            });
            filterCheckbox.addEventListener('change', (e) => {
                isFilterActive = e.target.checked;
                render();
            });
        }

        // --- 機能関数 ---

        // ToDoの追加
        function addTodo() {
            const text = inputEl.value.trim();
            if (!text) {
                showError('タスクの内容を入力してください。');
                return;
            }

            try {
                const newTodo = {
                    id: Date.now(),
                    text: text,
                    completed: false
                };
                todos.unshift(newTodo); // 先頭に追加
                inputEl.value = '';
                inputEl.focus();
                render();
            } catch (e) {
                showError('タスクの追加に失敗しました。');
            }
        }

        // ToDoの削除
        function deleteTodo(id) {
            if(confirm('このタスクを削除してもよろしいですか？')) {
                try {
                    todos = todos.filter(todo => todo.id !== id);
                    render();
                } catch (e) {
                    showError('削除に失敗しました。');
                }
            }
        }

        // ToDoの完了状態切り替え
        function toggleTodo(id) {
            try {
                const todo = todos.find(t => t.id === id);
                if (todo) {
                    todo.completed = !todo.completed;
                    render();
                }
            } catch (e) {
                showError('ステータスの更新に失敗しました。');
            }
        }

        // ToDoの編集開始
        function startEditing(id, textEl) {
            const todo = todos.find(t => t.id === id);
            if (!todo) return;

            // 既存のテキスト要素をinput要素に置換
            const currentText = todo.text;
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentText;
            input.className = 'bg-forest-900 text-leaf-100 border border-wood-600 rounded px-2 py-1 w-full focus:outline-none focus:ring-1 focus:ring-wood-500';
            
            // 保存処理
            const save = () => {
                const newText = input.value.trim();
                if (newText) {
                    todo.text = newText;
                    render(); // 再描画してテキストに戻す
                } else {
                    showError('タスク名は空にできません。');
                    render(); // 元に戻す
                }
            };

            // フォーカスが外れたら保存
            input.addEventListener('blur', save);
            // Enterキーで保存
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    input.blur(); // blurイベントを発火させて保存
                }
            });

            textEl.replaceWith(input);
            input.focus();
        }

        // エラーメッセージ表示
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'bg-red-900/90 border border-red-700 text-red-100 px-4 py-3 rounded shadow-lg mb-2 flex items-center gap-2 fade-in pointer-events-auto';
            errorDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> <span>${message}</span>`;
            
            errorContainer.appendChild(errorDiv);

            // 3秒後に消える
            setTimeout(() => {
                errorDiv.style.opacity = '0';
                errorDiv.style.transition = 'opacity 0.5s';
                setTimeout(() => errorDiv.remove(), 500);
            }, 3000);
        }

        // --- 描画関数 ---
        function render() {
            todoListEl.innerHTML = '';
            
            // フィルタリング処理
            const filteredTodos = isFilterActive 
                ? todos.filter(todo => !todo.completed) 
                : todos;

            // カウント更新
            taskCountEl.textContent = filteredTodos.length;

            if (filteredTodos.length === 0) {
                todoListEl.innerHTML = `
                    <li class="p-8 text-center text-forest-500 italic">
                        タスクはありません... 森は静かです。
                    </li>`;
                return;
            }

            filteredTodos.forEach(todo => {
                const li = document.createElement('li');
                li.className = `todo-item p-4 hover:bg-forest-700/50 transition-colors border-b border-forest-700 last:border-0 flex items-center gap-4 ${todo.completed ? 'completed bg-forest-900/30' : ''}`;
                
                // チェックボックス
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'custom-checkbox flex-shrink-0';
                checkbox.checked = todo.completed;
                checkbox.addEventListener('change', () => toggleTodo(todo.id));

                // テキストコンテナ
                const textContainer = document.createElement('div');
                textContainer.className = 'flex-grow min-w-0'; // min-w-0 for flex truncation

                // テキスト（span）
                const textSpan = document.createElement('span');
                textSpan.className = 'todo-text block text-lg truncate cursor-text';
                textSpan.textContent = todo.text;
                textSpan.title = "クリックして編集";
                // クリックで編集モード
                textSpan.addEventListener('click', () => {
                    if (!todo.completed) { // 完了済みは編集させない、あるいは編集時に未完了に戻すなどの仕様も可。今回は未完了のみ。
                         startEditing(todo.id, textSpan);
                    }
                });

                textContainer.appendChild(textSpan);

                // アクションボタンコンテナ
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'flex items-center gap-2 flex-shrink-0 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity';
                // モバイルでは常に表示、PCではホバー時に表示などの工夫のためクラス調整
                // 今回はシンプルにするため常に表示するスタイルにするが、クラス名で調整可能
                li.classList.add('group'); // 親要素にgroupクラスを追加

                // 編集アイコン（モバイル等で分かりやすくするため明示的なボタンも用意）
                const editBtn = document.createElement('button');
                editBtn.className = `text-forest-500 hover:text-leaf-200 transition-colors p-2 ${todo.completed ? 'hidden' : ''}`;
                editBtn.innerHTML = '<i class="fas fa-pen"></i>';
                editBtn.title = "編集";
                editBtn.addEventListener('click', () => startEditing(todo.id, textSpan));

                // 削除ボタン
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'text-wood-600 hover:text-red-400 transition-colors p-2';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteBtn.title = "削除";
                deleteBtn.addEventListener('click', () => deleteTodo(todo.id));

                actionsDiv.appendChild(editBtn);
                actionsDiv.appendChild(deleteBtn);

                li.appendChild(checkbox);
                li.appendChild(textContainer);
                li.appendChild(actionsDiv);

                todoListEl.appendChild(li);
            });
        }

        // アプリ起動
        init();

    </script>
</body>
</html>