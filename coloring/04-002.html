<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple ToDo</title>
    
    <!-- Google Fonts: Noto Sans JP for natural Japanese text -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Tailwind Config for Custom Colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Natural / Skin-friendly theme
                        ecru: {
                            50: '#fcfbf9',
                            100: '#faf7f2', // Main Background
                            200: '#f0ece4', // Card Background
                            300: '#e0d8cc',
                            800: '#5c5550', // Main Text
                            900: '#4a4440',
                        },
                        sage: {
                            100: '#eef2f0',
                            200: '#dce5e1',
                            300: '#bccdc6',
                            500: '#8da399', // Primary Sage Green
                            600: '#748b80', // Hover state
                            700: '#5b6e65',
                        },
                        clay: {
                            500: '#c77d63', // Error color (soft terracotta)
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(92, 85, 80, 0.05)',
                        'inner-soft': 'inset 0 2px 4px 0 rgba(0, 0, 0, 0.03)',
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom transitions */
        .todo-item {
            transition: all 0.3s ease;
        }
        .todo-item:hover {
            transform: translateY(-1px);
        }
        /* Hide scrollbar for cleaner look if needed */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* Custom checkbox style */
        .custom-checkbox input:checked + div {
            background-color: #8da399;
            border-color: #8da399;
        }
        .custom-checkbox input:checked + div svg {
            display: block;
        }
        
        /* Fade in animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
    </style>
</head>
<body class="bg-ecru-100 text-ecru-800 min-h-screen font-sans selection:bg-sage-200 selection:text-ecru-900 flex flex-col items-center py-8 px-4 sm:px-6">

    <!-- Error Toast Notification Container -->
    <div id="error-container" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 w-full max-w-sm pointer-events-none transition-all duration-300">
        <!-- Errors will be injected here -->
    </div>

    <!-- Main Container -->
    <main class="w-full max-w-lg">
        
        <!-- Header -->
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold tracking-wider text-sage-600 mb-2">Daily Tasks</h1>
            <p class="text-sm text-ecru-800 opacity-70">心地よい暮らしのためのToDoリスト</p>
        </header>

        <!-- Input Area -->
        <div class="bg-white rounded-2xl shadow-soft p-2 mb-6 flex items-center gap-2 border border-ecru-200">
            <input 
                type="text" 
                id="new-todo-input" 
                placeholder="新しいタスクを入力..." 
                class="flex-1 bg-transparent border-none outline-none px-4 py-3 text-ecru-800 placeholder-ecru-300 text-base"
                autocomplete="off"
            >
            <button 
                onclick="app.addTodo()" 
                class="bg-sage-500 hover:bg-sage-600 text-white p-3 rounded-xl transition-colors duration-200 flex-shrink-0 shadow-sm"
                aria-label="タスクを追加"
            >
                <i data-lucide="plus" class="w-5 h-5"></i>
            </button>
        </div>

        <!-- Filter Tabs -->
        <div class="flex justify-center gap-4 mb-6 text-sm font-medium">
            <button 
                onclick="app.setFilter('all')" 
                id="filter-all"
                class="px-4 py-2 rounded-full transition-all duration-200 bg-sage-500 text-white shadow-sm"
            >
                すべて
            </button>
            <button 
                onclick="app.setFilter('active')" 
                id="filter-active"
                class="px-4 py-2 rounded-full transition-all duration-200 text-ecru-800 hover:bg-ecru-200"
            >
                未完了のみ
            </button>
        </div>

        <!-- Todo List -->
        <div class="bg-white/60 backdrop-blur-sm rounded-3xl shadow-soft p-1 min-h-[300px] border border-white">
            <ul id="todo-list" class="space-y-2 p-3">
                <!-- Items will be injected here -->
            </ul>
            
            <!-- Empty State -->
            <div id="empty-state" class="hidden flex-col items-center justify-center h-48 text-ecru-300">
                <i data-lucide="leaf" class="w-12 h-12 mb-3 opacity-50"></i>
                <p>タスクはありません</p>
            </div>
        </div>

        <!-- Footer Info -->
        <footer class="mt-8 text-center text-xs text-ecru-800 opacity-40">
            <p>Simple ToDo App &copy; 2024</p>
        </footer>
    </main>

    <script>
        // --- Application Logic ---
        
        const app = {
            data: {
                todos: [],
                filter: 'all', // 'all' or 'active'
                editingId: null
            },

            // Initialization
            init() {
                // Initial Dummy Data
                this.data.todos = [
                    { id: 1, text: 'オーガニックコットンタオルの洗濯', completed: false },
                    { id: 2, text: '週末のハーブティーの買い出し', completed: false },
                    { id: 3, text: '観葉植物の水やり', completed: false },
                    { id: 4, text: 'ヨガのオンラインレッスン予約', completed: false },
                    { id: 5, text: 'アロマディフューザーの掃除', completed: true }
                ];
                
                this.render();
                lucide.createIcons();
                
                // Keyboard event for input
                document.getElementById('new-todo-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.addTodo();
                });
            },

            // Core Operations
            addTodo() {
                const input = document.getElementById('new-todo-input');
                const text = input.value.trim();

                if (!text) {
                    this.showError('タスクの内容を入力してください。');
                    return;
                }

                try {
                    // Simulate API Call
                    const newTodo = {
                        id: Date.now(),
                        text: text,
                        completed: false
                    };
                    
                    this.data.todos.unshift(newTodo);
                    input.value = '';
                    this.render();
                } catch (error) {
                    this.showError('データの追加に失敗しました。');
                }
            },

            toggleComplete(id) {
                try {
                    const todo = this.data.todos.find(t => t.id === id);
                    if (todo) {
                        todo.completed = !todo.completed;
                        this.render();
                    }
                } catch (error) {
                    this.showError('ステータスの更新に失敗しました。');
                }
            },

            deleteTodo(id) {
                if (!confirm('このタスクを削除してもよろしいですか？')) return;

                try {
                    this.data.todos = this.data.todos.filter(t => t.id !== id);
                    this.render();
                } catch (error) {
                    this.showError('削除に失敗しました。');
                }
            },

            // Editing Features
            startEditing(id) {
                this.data.editingId = id;
                this.render();
                
                // Focus the input immediately
                setTimeout(() => {
                    const editInput = document.getElementById(`edit-input-${id}`);
                    if (editInput) {
                        editInput.focus();
                        editInput.select();
                    }
                }, 10);
            },

            saveEdit(id, newText) {
                if (this.data.editingId !== id) return; // Prevent double save on blur+enter

                try {
                    if (!newText.trim()) {
                        this.showError('タスクの内容は空にできません。');
                        return;
                    }

                    const todo = this.data.todos.find(t => t.id === id);
                    if (todo) {
                        todo.text = newText.trim();
                    }
                    this.data.editingId = null;
                    this.render();
                } catch (error) {
                    this.showError('更新に失敗しました。');
                }
            },

            cancelEdit() {
                this.data.editingId = null;
                this.render();
            },

            // Filtering
            setFilter(filterType) {
                this.data.filter = filterType;
                
                // Update Button Styles
                const btnAll = document.getElementById('filter-all');
                const btnActive = document.getElementById('filter-active');
                
                const activeClass = "bg-sage-500 text-white shadow-sm";
                const inactiveClass = "text-ecru-800 hover:bg-ecru-200";

                if (filterType === 'all') {
                    btnAll.className = `px-4 py-2 rounded-full transition-all duration-200 ${activeClass}`;
                    btnActive.className = `px-4 py-2 rounded-full transition-all duration-200 ${inactiveClass}`;
                } else {
                    btnAll.className = `px-4 py-2 rounded-full transition-all duration-200 ${inactiveClass}`;
                    btnActive.className = `px-4 py-2 rounded-full transition-all duration-200 ${activeClass}`;
                }

                this.render();
            },

            // Error Handling UI
            showError(message) {
                const container = document.getElementById('error-container');
                const toast = document.createElement('div');
                toast.className = 'bg-clay-500 text-white px-4 py-3 rounded-xl shadow-lg mb-2 flex items-center gap-2 animate-fade-in pointer-events-auto mx-4';
                toast.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
                    <span class="text-sm font-medium">${message}</span>
                `;

                container.appendChild(toast);

                // Auto remove after 3 seconds
                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateY(-10px)';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            },

            // Rendering
            render() {
                const list = document.getElementById('todo-list');
                const emptyState = document.getElementById('empty-state');
                
                // Filter Logic
                const visibleTodos = this.data.todos.filter(t => {
                    if (this.data.filter === 'active') return !t.completed;
                    return true;
                });

                if (visibleTodos.length === 0) {
                    list.innerHTML = '';
                    emptyState.classList.remove('hidden');
                    emptyState.classList.add('flex');
                    return;
                }

                emptyState.classList.add('hidden');
                emptyState.classList.remove('flex');

                list.innerHTML = visibleTodos.map(todo => {
                    const isEditing = this.data.editingId === todo.id;
                    const isCompleted = todo.completed;

                    return `
                        <li class="todo-item animate-fade-in bg-white border border-ecru-100 rounded-xl p-3 flex items-center gap-3 group hover:border-sage-200">
                            <!-- Checkbox -->
                            <label class="custom-checkbox cursor-pointer relative flex items-center justify-center w-6 h-6 flex-shrink-0">
                                <input type="checkbox" class="sr-only" 
                                    ${isCompleted ? 'checked' : ''} 
                                    onchange="app.toggleComplete(${todo.id})"
                                >
                                <div class="w-5 h-5 border-2 border-sage-300 rounded-md transition-colors duration-200 flex items-center justify-center bg-white hover:border-sage-500">
                                    <svg class="w-3.5 h-3.5 text-white hidden pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3"><polyline points="20 6 9 17 4 12"></polyline></svg>
                                </div>
                            </label>

                            <!-- Content -->
                            <div class="flex-1 min-w-0">
                                ${isEditing ? `
                                    <input 
                                        type="text" 
                                        id="edit-input-${todo.id}"
                                        value="${todo.text}" 
                                        class="w-full bg-ecru-50 border border-sage-300 rounded px-2 py-1 text-ecru-800 outline-none focus:border-sage-500 focus:ring-1 focus:ring-sage-500 transition-all"
                                        onblur="app.saveEdit(${todo.id}, this.value)"
                                        onkeydown="if(event.key === 'Enter') app.saveEdit(${todo.id}, this.value); if(event.key === 'Escape') app.cancelEdit()"
                                    >
                                ` : `
                                    <span 
                                        onclick="app.startEditing(${todo.id})"
                                        class="cursor-text block truncate select-none transition-all duration-300 ${isCompleted ? 'text-sage-300 line-through' : 'text-ecru-800'}"
                                        title="クリックして編集"
                                    >
                                        ${todo.text}
                                    </span>
                                `}
                            </div>

                            <!-- Delete Button -->
                            <button 
                                onclick="app.deleteTodo(${todo.id})"
                                class="text-ecru-300 hover:text-clay-500 hover:bg-ecru-50 p-2 rounded-lg transition-all duration-200 opacity-0 group-hover:opacity-100 focus:opacity-100"
                                aria-label="削除"
                            >
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </li>
                    `;
                }).join('');

                // Re-initialize icons for newly added elements
                lucide.createIcons();
            }
        };

        // Start App
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });

    </script>
</body>
</html>